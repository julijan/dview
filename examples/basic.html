<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.1.1/css/bootstrap.min.css" integrity="sha512-6KY5s6UI5J7SVYuZB4S/CZMyPylqyyNZco376NM2Z8Sb8OxEdp02e1jkKk/wZxIEmjQ6DRCEBhni+gpr9c4tvA==" crossorigin="anonymous"/>
    <title>Test6</title>
    <script src="../dview.js"></script>
    <script>
        window.addEventListener('load', function() {
            const app = new DView({
                userCount : function() {
                    return this.data.users.length;
                },
                users : [
                    {
                        username : 'user1',
                        email : 'user1@test.com'
                    },
                    {
                        username : 'user2',
                        email : 'user2@test.com'
                    }
                ]
            }, {
                userAdd : function() {
                    let username = 'user' + (this.data.userCount + 1);
                    let user = {
                        username,
                        email : username + '@test.com'
                    }
                    this.data.users.add(user);
                }
            });

            app.query(['usercount']).subscribe(app.data, 'users');

            window.d = app;
        });
    </script>
</head>
<body>

    <div>
        User count: <userCount></userCount> <button d-click="userAdd">Add user</button>
    </div>
    <users>
        <user>
            <div>
                <b><username></username></b>, <email></email>
            </div>
        </user>
    </users>


</body>
</html>